<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/stylesheets/blog.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <title><%= blog.title %> - Bloggy</title>
</head>
<body>
    <nav class="glass-nav">
        <div class="logo">Bloggy</div>
        <div class="nav-links">
            <a href="/">Home</a>
            <a href="#featured">Featured</a>
            <a href="#about">About</a>
            <a href="#contact">Contact</a>
        </div>
        <div class="nav-controls">
            <a href="/create-post" class="create-post-btn">
                <i class="fas fa-plus"></i>
                Create Post
            </a>
            <a href="/profile" class="profile-btn" title="<%= user.name %>">
                <img src="<%= user.avatar %>" alt="Profile" class="profile-icon">
            </a>
        </div>
    </nav>

    <main>
        <article>
            <header class="blog-header">
                <h1 class="blog-title"><%= blog.title %></h1>
                <div class="blog-meta">
                    <div class="meta-item">
                        <i class="far fa-clock"></i>
                        <span id="read-time">5 min read</span>
                    </div>
                    <div class="meta-item">
                        <i class="far fa-calendar"></i>
                        <span><%= new Date(blog.created_at).toLocaleDateString('en-US', { 
                            weekday: 'long', 
                            year: 'numeric', 
                            month: 'short', 
                            day: 'numeric',
                        }) %></span>
                        <!-- <span>Oct 25, 2024</span> -->
                    </div>
                    <div class="meta-item">
                        <i class="far fa-eye"></i>
                        <span id="views-count"><%= blog.views %></span>
                        <!-- 1.2k views -->
                    </div>
                </div>
                <div class="tags-container">
                    <span class="tag">Design</span>
                    <span class="tag">Web Development</span>
                    <span class="tag">Trends</span>
                </div>
            </header>
            <% if (blog.coverImage) { %>
                <img src="<%= blog.coverImage %>" alt="Blog cover image" class="cover-image">
            <% } %>

            <div class="author-info">
                <img src="<%= blog.user.avatar %>" alt="<%= blog.user.name %>" class="author-avatar">
                <div class="author-details">
                    <div class="author-name"><%= blog.user.name %></div>
                    <div class="author-role"><%= blog.user.role %></div>
                </div>
            </div>
            <div class="blog-actions">
                <form class="blog-action-form" action="/blog/<%= blog.id %>/edit" method="GET">
                    <button type="submit" class="blog-action-btn edit">
                        <i class="fas fa-edit"></i>
                        Edit Post
                    </button>
                </form>
                
                <form class="blog-action-form" action="/blog/<%= blog.id %>/delete?_method=DELETE" method="POST" id="deleteForm">
                    <button type="button" class="blog-action-btn delete" id="deleteBtn">
                        <i class="fas fa-trash"></i>
                        Delete Post
                    </button>
                </form>
            </div>         
            <div class="blog-content">
                <%= blog.content %>
            </div>

            <div class="share-section">
                <div class="share-buttons">
                    <button class="share-btn">
                        <i class="fab fa-twitter"></i>
                    </button>
                    <button class="share-btn">
                        <i class="fab fa-facebook-f"></i>
                    </button>
                    <button class="share-btn">
                        <i class="fab fa-linkedin-in"></i>
                    </button>
                    <button class="share-btn">
                        <i class="far fa-copy"></i>
                    </button>
                </div>
            </div>
        </article>
        <!-- New Comments Section -->
        <section class="comments-section">
            <h2 class="comments-header">
                Comment(s)
                <span class="comment-count"></span>
            </h2>

            <form id="comment-form" class="comment-form">
                <div class="comment-input-group">
                    <img src="<%= blog.user.avatar %>" alt="User avatar" class="commenter-avatar">
                    <input type="hidden" name="blogId" value="<%= blog.id %>">
                    <textarea 
                        placeholder="Share your thoughts..." 
                        class="comment-input"
                        rows="3"
                        name="content"
                    ></textarea>
                </div>
                <div class="comment-form-actions">
                    <button type="button" class="btn-cancel">Cancel</button>
                    <button type="submit" class="btn-submit">Comment</button>
                </div>
            </form>

            <div class="comments-list">
                <!-- Comments will be dynamically added here -->
            </div>

            <div class="pagination-controls">
                <button class="pagination-btn" id="prev-page" disabled>
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                <div class="pagination-info">
                    Page <span id="current-page">1</span> of <span id="total-pages">1</span>
                </div>
                <button class="pagination-btn" id="next-page" disabled>
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </section>
    </main>

    <div class="modal-overlay"></div>
    <div class="delete-modal">
        <div class="delete-modal-header">
            <i class="fas fa-exclamation-triangle"></i>
            <h3 class="delete-modal-title">Delete Post</h3>
        </div>
        <div class="delete-modal-content">
            Are you sure you want to delete this post? This action cannot be undone.
        </div>
        <div class="delete-modal-actions">
            <button class="modal-btn cancel" id="cancelDelete">Cancel</button>
            <button class="modal-btn delete" id="confirmDelete">Delete</button>
        </div>
    </div>    

    <script src="/javascripts/modal.js"></script>
    <script src="/javascripts/blogUtils.js"></script>
    <script>
        const blogContent = document.querySelector(".blog-content");
        blogContent.innerHTML = window.blogUtils.decodeHTMLEntities(blogContent.innerHTML);

        const timeToRead = window.blogUtils.getReadingTime(blogContent.innerHTML);
        const readTime = document.getElementById("read-time");
        readTime.innerHTML = timeToRead;
        console.log(timeToRead);

        const viewsCount = document.getElementById('views-count');
        viewsCount.textContent = `${window.blogUtils.formatViews(parseInt(viewsCount.textContent))} views`;

        document.querySelector('.btn-cancel').addEventListener('click', function() {
            document.querySelector('.comment-input').value = '';
            document.querySelector('.comment-form-actions').style.display = 'none';
        });
    </script>
    <script src="/javascripts/userInfo.js"></script>
    <script src="/javascripts/blog.js"></script>
</body>
</html>